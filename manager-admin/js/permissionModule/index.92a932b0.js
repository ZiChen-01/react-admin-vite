import{r as e,F as a,j as l,D as s,X as r,ab as n,ac as t,ad as d,ae as i,e as o,T as c,y as h,af as u,h as m,R as x,I as p,m as j}from"../.store/.store.b1843e49.js";import{r as g,g as C,s as f}from"../index.46865e6c.js";import w from"./iconModule.d10d9daa.js";const b=e.forwardRef(((b,k)=>{let[y,I]=e.useState(""),[S]=a.useForm(),[v,F]=e.useState(""),[q,T]=e.useState(!1),[O,A]=e.useState("0"),[E,N]=e.useState(void 0),[R,V]=e.useState([]),[D,P]=e.useState(!0),[H,M]=e.useState(!1),[_,B]=e.useState(!1),[G,J]=e.useState(!1),[L,X]=e.useState(!1),[z,K]=e.useState(null),[Q,U]=e.useState(!1),W=e.useRef(null);e.useImperativeHandle(k,(()=>({setOpen:T,setTitle:F,setTreeData:V,entiForm:$,setRadioValue:A,childenForm:ee})));const Y=()=>{W.current.setIsModalOpen(!0)},Z=e=>{var a;!function a(l){l.forEach((l=>{l.id==e.id&&(j.loading("正在更新菜单，请稍后"),C().then((e=>{f.dispatch({type:"reload",data:!0})}))),l.children&&a(l.children)}))}(null==(a=JSON.parse(localStorage.getItem(window.envConfig.ROOT_APP_INFO)))?void 0:a.menuList)},$=e=>{S.setFieldsValue({name:e.name,url:e.url,component:e.component,icon:e.icon,sortNo:e.sortNo,menuType:1==e.menuType?e.parentId:null}),K(e.id),1==e.menuType&&N(e.parentId),A(String(e.menuType)),I(e.icon),P(e.route),M(e.hidden),B(e.keepAlive),J(e.alwaysShow),X(e.internalOrExternal)},ee=e=>{S.setFieldsValue({menuType:e.id}),N(e.id),U(!0)};return l.jsxs(l.Fragment,{children:[l.jsxs(s,{title:v,placement:"right",onClose:()=>{T(!1),S.resetFields(),P(!0),M(!1),B(!1),J(!1),X(!1),U(!1),I("")},open:q,closable:!1,width:"40%",className:"permissionModule",footer:l.jsxs(l.Fragment,{children:[l.jsx(r,{onClick:()=>T(!1),style:{marginRight:"10px"},children:"取消"}),l.jsx(r,{type:"primary",onClick:async()=>{try{let e=function(e){200==e.data.code&&(j.success(e.data.message),b.getlist(),T(!1),S.resetFields(),P(!0),M(!1),B(!1),J(!1),X(!1),U(!1))};let a={...await S.validateFields(),menuType:O,route:D,hidden:H,keepAlive:_,alwaysShow:G,internalOrExternal:L,parentId:1==O?E:null};if("新增菜单"==v||"添加下级菜单"==v){e(await g.addPermission(a))}else if("编辑菜单"==v){a.id=z;e(await g.editPermission(a)),Z(a)}}catch(e){}},children:"确认"})]}),children:[l.jsx(n,{banner:!0,closeText:"取消",message:l.jsx(t,{pauseOnHover:!0,gradient:!1,children:"新增以后请在前端工程pages目录下添加该组件，例如：pages/dashboard/analysis/index.jsx。"})}),l.jsxs(a,{name:"basic",form:S,labelCol:{span:5},wrapperCol:{span:20},initialValues:{remember:!0},autoComplete:"off",children:[l.jsx(a.Item,{label:"菜单类型",children:l.jsxs(d.Group,{value:O,onChange:e=>A(e.target.value),disabled:Q,children:[l.jsx(d,{value:"0",children:" 一级菜单 "}),l.jsx(d,{value:"1",children:" 子菜单 "})]})}),1==O?l.jsx(a.Item,{label:"上级菜单",name:"menuType",rules:[{required:!0,message:"请输入菜单名称!"}],children:l.jsx(i,{showSearch:!0,style:{width:"100%"},value:E,dropdownStyle:{maxHeight:400,overflow:"auto"},placeholder:"请选择上级菜单",allowClear:!0,treeDefaultExpandAll:!0,onChange:e=>{N(e)},treeData:R,disabled:Q})}):"",l.jsx(a.Item,{label:"菜单名称",name:"name",rules:[{required:!0,message:"请输入菜单名称!"}],children:l.jsx(o,{placeholder:"请输入菜单名称",allowClear:!0})}),l.jsx(a.Item,{label:"菜单路径",name:"url",rules:[{required:!0,message:"请输入菜单路径!"}],children:l.jsx(o,{placeholder:"请输入菜单路径，示例：/dashboard/analysis",allowClear:!0})}),l.jsx(a.Item,{label:"前端组件",name:"component",rules:[{required:!0,message:"请输入前端组件!"}],children:l.jsx(o,{placeholder:"请输入前端组件，示例：dashboard/analysis",allowClear:!0})}),0==O?l.jsx(a.Item,{label:"默认跳转地址",name:"redirect",rules:[{required:!1,message:"请输入默认跳转地址!"}],children:l.jsx(o,{placeholder:"请输入默认跳转地址 redirect",allowClear:!0})}):"",l.jsx(a.Item,{label:"菜单图标",name:"icon",rules:[{required:!1,message:"请选择菜单图标!"}],children:l.jsx(o,{placeholder:"请选择菜单图标",onClick:Y,addonBefore:y?l.jsx(c,{title:"当前图标",children:(ae=y,x.createElement(p[ae]))}):"",addonAfter:l.jsx(c,{title:"设置图标",children:l.jsx(h,{onClick:Y})}),allowClear:!0,onChange:e=>{e.target.value||I("")}})}),l.jsx(a.Item,{label:"菜单排序",name:"sortNo",rules:[{required:!1,message:""}],children:l.jsx(u,{placeholder:"请输入菜单排序",style:{width:"200px"}})}),l.jsx(a.Item,{label:"是否路由菜单",name:"route",rules:[{required:!1,message:""}],children:l.jsx(m,{defaultChecked:!0,checkedChildren:"是",unCheckedChildren:"否",checked:D,onChange:e=>P(e)})}),l.jsx(a.Item,{label:"隐藏路由",name:"hidden",rules:[{required:!1,message:""}],children:l.jsx(m,{checkedChildren:"是",unCheckedChildren:"否",checked:H,onChange:e=>M(e)})}),l.jsx(a.Item,{label:"是否缓存路由",name:"keepAlive",rules:[{required:!1,message:""}],children:l.jsx(m,{checkedChildren:"是",unCheckedChildren:"否",checked:_,onChange:e=>B(e)})}),l.jsx(a.Item,{label:"聚合路由",name:"alwaysShow",rules:[{required:!1,message:""}],children:l.jsx(m,{checkedChildren:"是",unCheckedChildren:"否",checked:G,onChange:e=>J(e)})}),l.jsx(a.Item,{label:"打开方式",name:"internalOrExternal",rules:[{required:!1,message:""}],children:l.jsx(m,{checkedChildren:"外部",unCheckedChildren:"内部",checked:L,onChange:e=>X(e)})})]})]}),l.jsx(w,{ref:W,setIcon:e=>{S.setFieldsValue({icon:e}),I(e)}})]});var ae}));export{b as default};
