import{r as e,j as t,O as n,Q as a,X as s,a5 as i,a9 as r,S as c,h as o,a6 as l,P as d,m as u,M as h,aa as m,R as p,I as x}from"../.store/.store.b1843e49.js";import{r as g,g as f,s as j}from"../index.46865e6c.js";import y from"../permissionModule/index.92a932b0.js";import"../permissionModule/iconModule.d10d9daa.js";function k(){let[k,S]=e.useState(!1),[w,T]=e.useState([]),[O,C]=e.useState(!1),[I,v]=e.useState([]),R=e.useRef(null),[N,b]=e.useState(0),[P,E]=e.useState(1),[F,z]=e.useState(10),M={current:P,pageSize:F,pageSizeOptions:["10","20","30","50","100"],showTotal:(e,t)=>t[0]+"-"+t[1]+" 共"+e+"条",showQuickJumper:!1,showSizeChanger:!0,total:N,onChange:e=>{E(e)},onShowSizeChange:(e,t)=>{z(t),E(1)}};const _=[{title:"菜单名称",dataIndex:"name",align:"center",key:"name",width:260},{title:"菜单类型",dataIndex:"menuType",align:"center",key:"menuType",render:function(e){return 0==e||1==e?"菜单":2==e?"按钮/权限":e}},{title:"icon",dataIndex:"icon",align:"center",key:"icon",render:function(e){return e?(t=e,p.createElement(x[t])):e;var t}},{title:"组件",dataIndex:"component",align:"center",key:"component",scopedSlots:{customRender:"component"}},{title:"路径",dataIndex:"url",align:"center",key:"url",scopedSlots:{customRender:"url"}},{title:"排序",dataIndex:"sortNo",align:"center",key:"sortNo"},{title:"操作",dataIndex:"action",fixed:"right",scopedSlots:{customRender:"action"},align:"center",width:250,render:(e,n,a)=>{let i=["首页","系统管理","用户管理","角色管理","菜单管理","机构管理"];return t.jsxs(t.Fragment,{children:[t.jsx(s,{type:"link",disabled:"首页"==n.name,onClick:()=>D(n),children:"编辑"}),t.jsx(d,{title:"确定要删除此菜单?",onConfirm:()=>L(n),okText:"确定",cancelText:"取消",disabled:i.includes(n.name),children:t.jsx(s,{type:"link",disabled:i.includes(n.name),children:"删除"})}),t.jsx(s,{type:"link",onClick:()=>J(n),children:"添加下级"})]})}}];e.useEffect((()=>{A()}),[P,F]);const A=async()=>{S(!0);const e=await g.getmenulist({pageIndex:P,pageSize:F});0==e.data.code&&(T(e.data.result),b(e.data.result.total)),S(!1)},D=e=>{R.current.setOpen(!0),R.current.setTitle("编辑菜单"),R.current.entiForm(e);let t=w;!function e(t){t.forEach((t=>{t.value=t.key,t.children&&e(t.children)}))}(t),R.current.setTreeData(t)},J=e=>{R.current.setOpen(!0),R.current.setRadioValue("1"),R.current.setTitle("添加下级菜单"),R.current.childenForm(e);let t=w;!function e(t){t.forEach((t=>{t.value=t.key,t.children&&e(t.children)}))}(t),R.current.setTreeData(t)},L=async e=>{const t=await g.deletePermission({id:e.id});200==t.data.code&&(Q(e),u.success(t.data.message),A())},Q=e=>{var t;!function t(n){n.forEach((n=>{n.id==e.id&&(u.loading("正在更新菜单，请稍后"),f().then((e=>{j.dispatch({type:"reload",data:!0})}))),n.children&&t(n.children)}))}(null==(t=JSON.parse(localStorage.getItem(window.envConfig.ROOT_APP_INFO)))?void 0:t.menuList)},V={onChange:(e,t)=>{v(e)}},B=e=>{var t;let n=null==(t=JSON.parse(localStorage.getItem(window.envConfig.ROOT_APP_INFO)))?void 0:t.menuList;const a=(e,t)=>{for(const n of e){if(n.id===t)return u.loading("正在更新菜单，请稍后"),f().then((e=>{j.dispatch({type:"reload",data:!0})})),!0;if(n.children){if(a(n.children,t))return!0}}return!1};for(const s of e)if(a(n,s))break};return t.jsx(t.Fragment,{children:t.jsxs("div",{id:"permission",children:[t.jsxs(n,{justify:"space-between",className:"buttonbox",children:[t.jsxs(a,{children:[t.jsx(s,{type:"primary",icon:t.jsx(i,{}),onClick:()=>{R.current.setOpen(!0),R.current.setRadioValue("0"),R.current.setTitle("新增菜单");let e=w;!function e(t){t.forEach((t=>{t.value=t.key,t.children&&e(t.children)}))}(e),R.current.setTreeData(e)},children:" 新增"}),0!=I.length?t.jsx(s,{icon:t.jsx(r,{}),onClick:()=>{h.confirm({title:"确认删除",icon:t.jsx(m,{}),content:"是否删除选中数据?",okText:"确认",cancelText:"取消",onOk:async()=>{let e=I.join(",");const t=await g.deleteAllPermission({ids:e});200==t.data.code&&(B(I),u.success(t.data.message),A(),v([]))}})},style:{marginLeft:"10px"},children:" 批量删除"}):""]}),t.jsx(a,{children:t.jsxs(c,{align:"center",style:{marginBottom:16},children:["父子关联: ",t.jsx(o,{checked:O,onChange:C})]})})]}),t.jsxs("div",{className:"alert",children:["已选择",t.jsx("span",{children:I.length}),"项",t.jsx("a",{onClick:()=>v([]),children:"清空"})]}),t.jsx(l,{columns:_,rowSelection:{selectedRowKeys:I,...V,checkStrictly:!O},dataSource:w,loading:k,pagination:M}),t.jsx(y,{ref:R,getlist:A})]})})}export{k as default};
