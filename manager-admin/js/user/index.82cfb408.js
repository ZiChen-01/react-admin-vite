import{r as e,F as a,_ as s,j as t,D as r,V as l,d as n,$ as d,a0 as i,m as o,J as c,K as u,a1 as m,a2 as h,a3 as x,a4 as p,z as j,P as g,S as b}from"../.store/.store.788e8884.js";import{r as y,C as w}from"../index.69c252cd.js";const{Option:f}=d,I=e.forwardRef(((c,u)=>{let[m,h]=e.useState(!1),[x,p]=e.useState(1),[j]=a.useForm();JSON.parse(localStorage.getItem("userInfo")||"0");let[g,b]=e.useState([]),[w,I]=e.useState([]),[C,S]=e.useState(!0),[k,v]=e.useState(null);e.useImperativeHandle(u,(()=>({setIsModalVisible:h,queryUserRole:E,getDeptTree:V,entiForm:F,setShowEle:S,setIsStatus:p})));const N=async e=>{try{const e=await j.validateFields();if(1==x){const a=await y.addUser(e);200==a.data.code&&(o.success(a.data.message),h(!1),c.getlist())}else if(2==x){const a=await y.userEdit({...e,id:k});200==a.data.code&&(o.success(a.data.message),h(!1),c.getlist())}}catch(a){}},E=async()=>{const e=await y.getRoleList({});0==e.data.code&&b(e.data.result)},V=async()=>{const e=await y.getDeptTreeList({});if(0==e.data.errCode){let a=JSON.parse(e.data.bizContent);I(a.tmpDeptInfos)}},F=async e=>{const a=await y.getRoleId({userid:e.id});let t=null;0==a.data.code&&(t=a.data.result[0]),j.setFieldsValue({username:e.username,realname:e.realname,workNo:e.workNo,selectedroles:t,orgCode:e.orgCode,birthday:e.birthday?s(e.birthday):null,sex:e.sex?String(e.sex):null,email:e.email,phone:e.phone}),v(e.id)};return t.jsx(t.Fragment,{children:t.jsx(r,{title:1==x?"添加用户":2==x?"编辑用户":"详情",open:m,onOk:N,closable:!1,onClose:()=>{h(!1),j.resetFields()},width:"40%",footer:t.jsxs(t.Fragment,{children:[t.jsx(l,{onClick:()=>{h(!1),j.resetFields()},style:{marginRight:"10px"},children:"取消"}),3!=x?t.jsx(l,{type:"primary",onClick:N,children:"提交"}):""]}),children:t.jsxs(a,{name:"basic",form:j,labelCol:{span:5},wrapperCol:{span:20},initialValues:{remember:!0},children:[t.jsx(a.Item,{label:"用户账号",name:"username",rules:[{required:!0,message:"请输入用户账号!"},{validator:async(e,a)=>{const s={tableName:"sys_user",fieldName:"username",fieldVal:a,dataId:k};if(500==(await y.duplicateCheck(s)).data.code)throw new Error("用户名已存在!")}}],children:t.jsx(n,{placeholder:"请输入用户账号",disabled:3==x})}),C?t.jsxs("div",{children:[t.jsx(a.Item,{label:"登录密码",name:"password",rules:[{required:!0,message:"请输入登录密码!"},{pattern:/^(?=.*[a-zA-Z])(?=.*\d)(?=.*[~!@#$%^&*()_+`\-={}:";'<>?,./]).{6,}$/,message:"密码由至少6位数字、大小写字母和特殊符号组成!"}],children:t.jsx(n.Password,{placeholder:"请输入登录密码"})}),t.jsx(a.Item,{label:"确认密码",name:"confirmpassword",required:!0,rules:[{required:!0,message:"请确认密码!"},({getFieldValue:e})=>({validator:(a,s)=>s&&e("password")!==s?Promise.reject("两次密码不一致，请重新输入"):Promise.resolve()})],children:t.jsx(n.Password,{placeholder:"请确认密码"})})]}):"",t.jsx(a.Item,{label:"用户姓名",name:"realname",rules:[{required:!0,message:"请输入用户姓名!"}],children:t.jsx(n,{placeholder:"请输入用户姓名",disabled:3==x})}),t.jsx(a.Item,{label:"工号",name:"workNo",rules:[{required:!0,message:"请输入工号!"},{validator:async(e,a)=>{if(a){const e={tableName:"sys_user",fieldName:"work_no",fieldVal:a,dataId:k};if(500==(await y.duplicateCheck(e)).data.code)throw new Error("工号已存在!")}else callback()}}],children:t.jsx(n,{placeholder:"请输入工号",disabled:3==x})}),t.jsx(a.Item,{label:"角色分配",name:"selectedroles",children:t.jsx(d,{placeholder:"请选择角色",disabled:3==x,getPopupContainer:e=>e.parentElement||document.body,children:g.map(((e,a)=>t.jsx(f,{value:e.id,children:e.roleName},a)))})}),t.jsx(a.Item,{label:"机构分配",name:"orgCode",children:t.jsx(d,{placeholder:"请选择机构",disabled:3==x,getPopupContainer:e=>e.parentElement||document.body,children:w.map(((e,a)=>t.jsx(f,{value:e.deptNo,children:e.deptName},a)))})}),t.jsx(a.Item,{label:"生日",name:"birthday",children:t.jsx(i,{disabled:3==x,getPopupContainer:e=>e.parentElement||document.body,placeholder:"请选择生日",style:{width:"100%"}})}),t.jsx(a.Item,{label:"性别",name:"sex",children:t.jsxs(d,{placeholder:"请选择性别",disabled:3==x,getPopupContainer:e=>e.parentElement||document.body,children:[t.jsx(f,{value:"1",children:"男"}),t.jsx(f,{value:"2",children:"女"})]})}),t.jsx(a.Item,{label:"邮箱",name:"email",rules:[{required:!0,message:""},{validator:async(e,a)=>{if(!new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/).test(a))throw new Error("请输入正确格式的邮箱!");{const e={tableName:"sys_user",fieldName:"email",fieldVal:a,dataId:k};if(500==(await y.duplicateCheck(e)).data.code)throw new Error("邮箱已存在!")}}}],children:t.jsx(n,{placeholder:"请输入邮箱",disabled:3==x})}),t.jsx(a.Item,{label:"手机号码",name:"phone",rules:[{required:!0,message:""},{validator:async(e,a)=>{if(!new RegExp(/^1[3|4|5|7|8|9][0-9]\d{8}$/).test(a))throw new Error("请输入正确格式的手机号码!");{const e={tableName:"sys_user",fieldName:"phone",fieldVal:a,dataId:k};if(500==(await y.duplicateCheck(e)).data.code)throw new Error("手机号已存在!")}}}],children:t.jsx(n,{placeholder:"请输入手机号码",disabled:3==x})})]})})})})),{Option:C}=d;function S(){let[s,r]=e.useState(""),[i,f]=e.useState(void 0),[S,k]=e.useState(""),[v,N]=e.useState(""),[E,V]=e.useState(void 0),[F,q]=e.useState([]),[R,z]=e.useState(!1);const T=e.useRef(null),D=e.useRef(null);let[P,U]=e.useState(0),[_,O]=e.useState(1),[L,M]=e.useState(10),$={current:_,pageSize:L,pageSizeOptions:["10","20","30","50","100"],showTotal:(e,a)=>a[0]+"-"+a[1]+" 共"+e+"条",showQuickJumper:!1,showSizeChanger:!0,total:P,onChange:e=>{O(e),H()},onShowSizeChange:(e,a)=>{M(a),O(1),H()}};const J=[{title:"用户账号",dataIndex:"username",align:"center",key:"username"},{title:"用户姓名",align:"center",dataIndex:"realname",key:"realname"},{title:"性别",align:"center",dataIndex:"sex",key:"sex",render:e=>{switch(e){case 1:return"男";case 2:return"女";default:return e}}},{title:"生日",align:"center",key:"birthday",dataIndex:"birthday"},{title:"手机号码",align:"center",dataIndex:"phone",key:"phone"},{title:"机构",align:"center",key:"orgCodeTxt",dataIndex:"orgCodeTxt"},{title:"状态",align:"center",key:"status",dataIndex:"status",render:e=>{switch(e){case 1:return"正常";case 2:return"冻结";default:return e}}},{title:"操作",dataIndex:"action",align:"center",render:(e,a,s)=>t.jsxs(t.Fragment,{children:[t.jsx("a",{onClick:()=>K(a),children:"编辑"}),t.jsx(j,{menu:{items:[{label:t.jsx("a",{children:" 详情"}),key:"1"},{label:t.jsx(g,{title:"确定要删除此用户?",onConfirm:()=>A(a),okText:"确定",cancelText:"取消",children:t.jsx("a",{children:" 删除"})}),key:"2",disabled:a.username.includes("admin")},{label:t.jsx("a",{children:" 修改密码"}),key:"3"}],onClick:e=>Z(e,a)},children:t.jsx("a",{onClick:e=>{e.preventDefault()},children:t.jsx(b,{children:"更多"})})})]})}],A=e=>{y.userDelete({id:e.id}).then((e=>{200==e.data.code&&(o.success(e.data.message),H())}))},Z=({key:e},a)=>{switch(e){case"1":T.current.setIsModalVisible(!0),T.current.entiForm(a),T.current.queryUserRole(),T.current.getDeptTree(),T.current.setShowEle(!1),T.current.setIsStatus(3);break;case"2":break;case"3":D.current.setIsModalVisible(!0),D.current.form.setFieldsValue({username:a.username}),D.current.setUserId(a.id)}},K=e=>{T.current.setIsModalVisible(!0),T.current.entiForm(e),T.current.queryUserRole(),T.current.getDeptTree(),T.current.setShowEle(!1),T.current.setIsStatus(2)};e.useEffect((()=>{H()}),[_]);const H=async()=>{z(!0);let e={username:s,sex:i,realname:S,phone:v,status:E,pageNo:_,pageSize:L};const a=await y.getUserList(e);0==a.data.code&&(q(a.data.result.records),U(a.data.result.total)),z(!1)};return t.jsx(t.Fragment,{children:t.jsxs("div",{className:"userList",children:[t.jsxs(c,{gutter:24,children:[t.jsx(u,{md:6,sm:12,children:t.jsx(a.Item,{label:"用户账号",children:t.jsx(n,{value:s,onChange:e=>r(e.target.value),placeholder:"请输入账号"})})}),t.jsx(u,{md:6,sm:12,children:t.jsx(a.Item,{label:"用户姓名",children:t.jsx(n,{value:S,placeholder:"请输入用户姓名",onChange:e=>k(e.target.value)})})}),t.jsx(u,{md:6,sm:12,children:t.jsx(a.Item,{label:"性别",children:t.jsxs(d,{defaultValue:i,value:i,onChange:e=>{f(e)},placeholder:"请选择性别",children:[t.jsx(C,{value:"1",children:"男"}),t.jsx(C,{value:"2",children:"女"})]})})}),t.jsx(u,{md:6,sm:12,children:t.jsx(a.Item,{label:"手机号码",children:t.jsx(n,{value:v,placeholder:"请输入手机号码",onChange:e=>N(e.target.value)})})}),t.jsx(u,{md:6,sm:12,children:t.jsx(a.Item,{label:"状态",children:t.jsxs(d,{defaultValue:E,value:E,onChange:e=>{V(e)},placeholder:"请选择用户状态",children:[t.jsx(C,{value:"1",children:"正常"}),t.jsx(C,{value:"2",children:"冻结"})]})})})]}),t.jsxs(c,{justify:"space-between",className:"buttonbox",children:[t.jsxs(u,{children:[t.jsx(l,{type:"primary",icon:t.jsx(m,{}),onClick:H,children:"查询"}),t.jsx(l,{type:"primary",icon:t.jsx(h,{}),onClick:()=>{r(""),f(void 0),k(""),N(""),V(void 0),O(1),s=S=v="",i=void 0,E=void 0,_=1,H()},style:{marginLeft:"10px"},children:"重置"})]}),t.jsx(u,{children:t.jsx(l,{type:"primary",icon:t.jsx(x,{}),onClick:()=>{T.current.setIsModalVisible(!0),T.current.queryUserRole(),T.current.getDeptTree(),T.current.setShowEle(!0),T.current.setIsStatus(1)},children:"添加用户"})})]}),t.jsx(p,{rowKey:e=>e.id,dataSource:F,columns:J,loading:R,pagination:$}),t.jsx(I,{ref:T,getlist:H}),t.jsx(w,{ref:D})]})})}export{S as default};
