import{r as e,a as s,j as a,a7 as t,R as i,C as l,D as r,B as n,b6 as c,aJ as d,m as o}from"./index-218c74fb.js";import{T as h}from"./index-09e239c2.js";import"./iconUtil-56e6581b.js";import"./List-8b86e5d9.js";const u=e.forwardRef(((u,j)=>{let[x,m]=e.useState(!1),[k,b]=e.useState(!1),[p,y]=e.useState({}),[f,S]=e.useState([]),[g,C]=e.useState([]),[I,R]=e.useState([]),[w,D]=e.useState([]),[L,M]=e.useState([]),[T,q]=e.useState(!1);e.useImperativeHandle(j,(()=>({setMenuVisible:b,queryMenuTreeList:v,setDetails:y})));const v=(e=null)=>{m(!0),s.queryMenuTreeList().then((s=>{if(0==s.data.code){let a=function(e){for(let s=0;s<e.length;s++){const t=e[s];i.includes(t.title)&&(t.disabled=!0),t.children&&a(t.children)}},t=E(s.data.result.treeList),i=["系统管理","用户管理","角色管理","菜单管理","机构管理"];e&&"admin"==e.roleCode&&a(t),S(t),D(s.data.result.ids),R(s.data.result.ids),F(e)}}))},E=e=>(e.forEach((e=>{e.title=e.slotTitle,e.children&&E(e.children)})),e),F=e=>{s.queryRolePermission({roleId:e.id}).then((e=>{m(!1),0==e.data.code&&(C(e.data.result),M(e.data.result))}))};return a.jsx(a.Fragment,{children:a.jsx(t,{title:"菜单角色权限配置",open:k,closable:!1,onClose:()=>{b(!1)},width:"40%",className:"MenuAuthorization",footer:a.jsx(a.Fragment,{children:a.jsxs(i,{justify:"space-between",className:"buttonbox",children:[a.jsx(l,{children:a.jsx(r,{trigger:["click"],menu:{items:[{label:a.jsx("a",{children:" 父子关联"}),key:"1"},{label:a.jsx("a",{children:" 取消关联"}),key:"2"},{label:a.jsx("a",{children:" 全部勾选"}),key:"3"},{label:a.jsx("a",{children:" 取消全选"}),key:"4"},{label:a.jsx("a",{children:" 展开所有"}),key:"5"},{label:a.jsx("a",{children:" 合并所有"}),key:"6"}],onClick:e=>(({key:e})=>{switch(e){case"1":q(!1);break;case"2":q(!0);break;case"3":C(I);break;case"4":C([]);break;case"5":D(I);break;case"6":D([])}})(e)},children:a.jsx("a",{onClick:e=>{e.preventDefault()},children:a.jsxs(n,{children:["树操作",a.jsx(c,{})]})})})}),a.jsxs(l,{children:[a.jsx(n,{onClick:()=>{b(!1)},style:{marginRight:"10px"},children:"取消"}),a.jsx(n,{type:"primary",onClick:()=>{let e={lastpermissionIds:L.join(","),permissionIds:g.join(","),roleId:p.id};s.saveRolePermission(e).then((e=>{200==e.data.code&&o.success(e.data.message),F(p),b(!1)}))},children:"提交"})]})]})}),children:a.jsx(d,{spinning:x,children:a.jsx(h,{checkable:!0,onCheck:(e,s)=>{C(e)},treeData:f,checkedKeys:g,expandedKeys:w,checkStrictly:T,onExpand:e=>{D(e)}})})})})}));export{u as default};
